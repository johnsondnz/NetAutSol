# Easy Wins

## Compliance Testing
* `./verify.sh` will call `tasks/compliance_play.yml`.
* This play triggers the roles `compliance` and `compliance_reports` which are found in `tasks/roles/`.
* The play uses `include_vars` to import variables from the `config_fabric` role.
  * `/tasks/roles/config_fabric/vars/main.yml`.
* A custom module I wrote called `compliance_test` can be found in `compliance` role `library` folder.
  * Used to standardise compliance testing it allows for key-value search with recursive search of structured data or;
  * python re.search of unstructured data.
  * the module returns ansible_facts for use later in report generation.
  * usage exmaples and returned facts are provided in the module.
  * results are standardised and prefix with `compliance_test_` before being returned as ansible_facts.
* Compliance tests:
  * `/tasks/roles/config_fabric/vars/main.yml` is used to generate an ansible_facts dictionary called `fabric_tests`
  * `show isis adjacency` is excuted on the Junos Olives
  * `fabric_tests.interface` is used as a re.search to look for the interface in an 'Up' state, i.e. 'em1.*?Up'
  * `fabric_tests.ping_dest` is passed to `naplam_ping` with results stored in `ping_results`
  * `ping_results` is passed to `compliance_test` module and result standardised.

## Compliance Reporting
* Triggered with running `./verify.sh`.
* Play creates `./reports` directory.
  * subdirectories `build` and `debug` are also created.
* Report header and contents are generated from the role `compliance_reports/templates` templates.
  * A report header is created for each host and placed into ./reports/build/{{ inventory_hostanme }}
  * Report content is created for each host and placed into ./reports/build/{{ inventory_hostanme }}
  * Report content is generated by looping through the ansible_facts prefixed with `compliance_test_` and passing it to `tasks/roles/compliance_reports/templates/output.j2`
* Assemble module is used to combine the header and report contents
* Each hosts assembled a report is placed into `./reports`
* Summary report information is placed at the end of each host report, including passed and failed test counts.
* Finally An aggregated report is generated combining all hosts into a MEGA report, it too is placed into `./reports`
